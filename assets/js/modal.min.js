/**
 * ModalWindows v1.4.0 ( https://github.com/MattRh/modal_wins )
 * MalSerAl, 2015-2016
 */
var modal={config:{modalBox:'.modal-box',modalsClass:'.modal',modalsCont:'.modal-wrapper',hideByKey:27,urlPrefix:''},tStamps:[],init:function(){this.modalRegExp=new RegExp('(\\s|^)'+this.config.modalsClass.substr(1)+'(\\s|$)');this.bodyStyle=document.body.style;this.modalBoxes=[];this.openedModal=[];this.nestingLVL=0;this.modalBoxes[1]=document.querySelector(this.config.modalBox);this.modalBoxes[1].style.cssText='display:none; opacity:0';this.boxTemplate=this.modalBoxes[1].cloneNode(true);this.__modalsCollect();this.__scrollSet();this.__anchorOpen()},show:function(e,s){var a,bodyStyle,el,lvl;el=document.getElementById(e);if(el===null||!el.className.match(this.modalRegExp)||!!~this.openedModal.indexOf(el))return false;if(s){this.__switchTo(el);return false}lvl=++this.nestingLVL;if(this.nestingLVL>1){this.modalBoxes[lvl]=this.boxTemplate.cloneNode(true);this.__insertAfter(this.modalBoxes[lvl],this.modalBoxes[lvl-1]);this.modalBoxes[lvl].querySelector(this.config.modalsCont).appendChild(el)}a=this.modalBoxes[lvl].style;bodyStyle=this.bodyStyle;bodyStyle.overflowY='hidden';bodyStyle.paddingRight=this.scrollBar;a.display='block';a.opacity=0;this.__animate(a,{'opacity':1},200,'main');this.__modalShow(el);if(this.config.hideByKey!==null)window.addEventListener('keyup',modal.__keyPress)},hide:function(){var a,bodyStyle,lvl;lvl=this.nestingLVL;a=this.modalBoxes[lvl].style;bodyStyle=this.bodyStyle;this.__animate(a,{'opacity':0},180,'main');this.__modalHide();setTimeout(function(){a.display='none';bodyStyle.overflowY=bodyStyle.paddingRight=null;if(lvl>1)modal.modalBoxes[lvl].parentNode.removeChild(modal.modalBoxes[lvl])},170);this.nestingLVL--;if(this.config.hideByKey!==null&&modal.nestingLVL==0)window.removeEventListener('keyup',modal.__keyPress)},__modalShow:function(e,s){var a;if(this.nestingLVL>1)this.modalBoxes[this.nestingLVL].querySelector(this.config.modalsCont).appendChild(e);this.openedModal[this.nestingLVL]=e;a=e.style;if(!s){a.cssText='display:block;opacity:1;top:-50px';this.__animate(a,{'top':0},220,'win')}else{a.cssText='display:block;opacity:0;top:50px';this.__animate(a,{'top':0,'opacity':1},220,'win')}},__modalHide:function(){var a,modalWin,modalWinSt;a=this.nestingLVL;modalWin=this.openedModal[a];modalWinSt=modalWin.style;this.__animate(modalWinSt,{'top':'-50px','opacity':0},190,'win');setTimeout(function(){modalWinSt.display='none';modal.modalBoxes[1].querySelector(modal.config.modalsCont).appendChild(modalWin)},190);this.openedModal[a]=null},__switchTo:function(e){this.__modalHide();setTimeout(function(){modal.__modalShow(e,true)},200)},__animate:function(s,o,t,a){var b='',stamp=new Date().getTime();for(var i in o)b+=i+' '+t+'ms ease,';b=b.slice(0,-1);s.transition=s.webkitTransition=b;a+='_'+this.nestingLVL;modal.tStamps[a]=stamp;setTimeout(function(){for(var i in o)s[i]=o[i]},15);setTimeout(function(){if(modal.tStamps[a]==stamp)s.transition=s.webkitTransition=null},t)},__keyPress:function(e){e.preventDefault();if(e.keyCode==modal.config.hideByKey)modal.hide()},__scrollSet:function(){var a,heightData;a=document.createElement('div');a.style.cssText='visibility:hidden;width:100px;height:100px;overflow-y:scroll';document.body.appendChild(a);heightData=this.__getHeight();this.scrollBar=heightData[0]<heightData[1]?a.offsetWidth-a.clientWidth+'px':0;document.body.removeChild(a)},__getHeight:function(){var a,windowHeight;if(window.innerHeight&&window.scrollMaxY)a=window.innerHeight+window.scrollMaxY;else if(document.body.scrollHeight>document.body.offsetHeight)a=document.body.scrollHeight;else if(document.documentElement&&document.documentElement.scrollHeight>document.documentElement.offsetHeight)a=document.documentElement.scrollHeight;else a=document.body.offsetHeight;if(self.innerHeight)windowHeight=self.innerHeight;else if(document.documentElement&&document.documentElement.clientHeight)windowHeight=document.documentElement.clientHeight;else if(document.body)windowHeight=document.body.clientHeight;return[windowHeight,a]},__insertAfter:function(e,p){return p.parentNode.insertBefore(e,p.nextSibling)},__modalsCollect:function(){var a,modals,i,len;a=this.modalBoxes[1].querySelector(this.config.modalsCont);modals=document.querySelectorAll(this.config.modalsClass);for(i=0,len=modals.length;i<len;i++){if(modals[i].parentNode==a)continue;a.appendChild(modals[i]);modals[i].style.display='none'}},__anchorOpen:function(){var a;if(this.config.urlPrefix!==null){a=window.location.hash.replace('#','');if(a!=''&&a.substr(0,this.config.urlPrefix.length)==this.config.urlPrefix){el=document.getElementById(a);if(el!=null&&el.className.match(this.modalRegExp))modal.show(a)}}}};window.onload=function(){modal.init()};
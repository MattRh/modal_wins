/**
 * ModalWindows v1.5.0 ( https://github.com/MattRh/modal_wins )
 * MalSerAl, 2015-2016
 * 
 * modal.show("modal_id") - openes modal with id=modal_id in new box
 * modal.show("modal_id", true) - switches to modal with id=modal_id in current box
 * modal.hide() or "ESC" - hides opened modal
 */
 
 var modal={config:{isInited:false,modalBox:'.modal-box',modalsClass:'.modal',modalsCont:'.modal-wrapper',show:{stat:'opened',dyn:'show',swch:'switch',},hide:{stat:'closed',dyn:'hide'},loadCls:'loaded',hideByKey:27,urlPrefix:''},tStamps:[],init:function(){if(modal.isInited)return false;modal.isInited=true;modal.__setAnimatonEndEvent();modal.modalBoxes=[];modal.modalBoxes[1]=document.querySelector(modal.config.modalBox);modal.__addClass(modal.modalBoxes[1],modal.config.hide.stat);modal.__addClass(modal.modalBoxes[1],modal.config.loadCls);modal.boxTemplate=modal.modalBoxes[1].cloneNode(true);modal.modalRegExp=new RegExp('(\\s|^)'+modal.config.modalsClass.substr(1)+'(\\s|$)');modal.bodyStyle=document.body.style;modal.openedModal=[];modal.nestingLVL=0;modal.__modalsCollect();modal.__scrollSet();modal.__anchorOpen()},show:function(a,s){var b,bodyStyle,el,lvl;modal.init();el=document.getElementById(a);if(el===null||!el.className.match(modal.modalRegExp)||!!~modal.openedModal.indexOf(el))return false;if(s){modal.__switchTo(el);return false}lvl=++modal.nestingLVL;if(modal.nestingLVL>1){modal.modalBoxes[lvl]=modal.boxTemplate.cloneNode(true);modal.__insertAfter(modal.modalBoxes[lvl],modal.modalBoxes[lvl-1]);modal.modalBoxes[lvl].querySelector(modal.config.modalsCont).appendChild(el)}bodyStyle=modal.bodyStyle;bodyStyle.overflowY='hidden';bodyStyle.paddingRight=modal.scrollBar;modal.__animate(modal.modalBoxes[lvl],'show');modal.__modalShow(el);if(modal.config.hideByKey!==null)window.addEventListener('keyup',modal.__keyPress);if(typeof(modal.onopen)=='function')modal.onopen(el);modal.__triggerEvent(modal.modalBoxes[lvl],'open')},hide:function(){var a=modal.nestingLVL;if(a==0)return false;var b=modal.modalBoxes[a];modal.__animate(modal.modalBoxes[a],'hide',function(){if(a>1)b.parentNode.removeChild(b);else modal.bodyStyle.overflowY=modal.bodyStyle.paddingRight=null});modal.__modalHide();modal.nestingLVL--;if(modal.config.hideByKey!==null&&modal.nestingLVL==0)window.removeEventListener('keyup',modal.__keyPress);if(typeof(modal.onclose)=='function')modal.onclose(b);modal.__triggerEvent(modal.modalBoxes[a],'close')},__modalShow:function(e,s){if(modal.nestingLVL>1)modal.modalBoxes[modal.nestingLVL].querySelector(modal.config.modalsCont).appendChild(e);modal.openedModal[modal.nestingLVL]=e;modal.__animate(e,'show'+(s?'_switch':''),function(){modal.__triggerEvent(e,'open')})},__modalHide:function(a){var b=modal.nestingLVL;var c=modal.openedModal[b];modal.__animate(c,'hide',function(){if(b>1)modal.modalBoxes[1].querySelector(modal.config.modalsCont).appendChild(c);if(typeof(a)=='function')a();modal.__triggerEvent(c,'close')});modal.openedModal[b]=null},__switchTo:function(e){modal.__modalHide(function(){modal.__modalShow(e,true)})},__animate:function(a,t,b){var c,swch,add,rem;t=t.split('_');c=t[0];swch=t[1]?true:false;if(c=='show'){add=modal.config.show;rem=modal.config.hide}else if(c=='hide'){add=modal.config.hide;rem=modal.config.show}else{return false}modal.__addClass(a,swch?add.swch:add.dyn);modal.__removeClass(a,rem.dyn);modal.__removeClass(a,rem.stat);a.addEventListener(modal.animEndEvent,function modalanimev(){a.removeEventListener(modal.animEndEvent,modalanimev);modal.__removeClass(a,swch?add.swch:add.dyn);modal.__addClass(a,add.stat);if(typeof(b)=='function')b()})},__modalsCollect:function(){var a,modals,i,len;a=modal.modalBoxes[1].querySelector(modal.config.modalsCont);modals=document.querySelectorAll(modal.config.modalsClass);for(i=0,len=modals.length;i<len;i++){if(modals[i].parentNode==a)continue;a.appendChild(modals[i]);modal.__addClass(modals[i],modal.config.hide.stat)}},__anchorOpen:function(){var a;if(modal.config.urlPrefix!==null){a=window.location.hash.replace('#','');if(a!=''&&a.substr(0,modal.config.urlPrefix.length)==modal.config.urlPrefix){el=document.getElementById(a);if(el!=null&&el.className.match(modal.modalRegExp))modal.show(a)}}},__scrollSet:function(){var a,heightData;a=document.createElement('div');a.style.cssText='visibility:hidden;width:100px;height:100px;overflow-y:scroll';document.body.appendChild(a);heightData=modal.__getHeight();modal.scrollBar=heightData[0]<heightData[1]?a.offsetWidth-a.clientWidth+'px':0;document.body.removeChild(a)},__keyPress:function(e){e.preventDefault();if(e.keyCode==modal.config.hideByKey)modal.hide()},__getHeight:function(){var a,windowHeight;if(window.innerHeight&&window.scrollMaxY)a=window.innerHeight+window.scrollMaxY;else if(document.body.scrollHeight>document.body.offsetHeight)a=document.body.scrollHeight;else if(document.documentElement&&document.documentElement.scrollHeight>document.documentElement.offsetHeight)a=document.documentElement.scrollHeight;else a=document.body.offsetHeight;if(self.innerHeight)windowHeight=self.innerHeight;else if(document.documentElement&&document.documentElement.clientHeight)windowHeight=document.documentElement.clientHeight;else if(document.body)windowHeight=document.body.clientHeight;return[windowHeight,a]},__setAnimatonEndEvent:function(){var i,l,styles,events,prefixes,hash,block,styleSheet;modal.animEndEvent=false;events=['animationend','webkitAnimationEnd','oAnimationEnd','MSAnimationEnd'];prefixes=['-webkit-','-moz-','-ms-','-o-',''];hash=modal.__genStr(12);styles='#'+hash+'{';for(i=0,l=prefixes.length;i<l;i++)styles+=prefixes[i]+'animation:'+hash+'-anim 2ms;';styles+='}';for(i=0,l=prefixes.length;i<l;i++)styles+='@'+prefixes[i]+'keyframes '+hash+'-anim{from {left:0} to {left:1px}}';styleSheet=document.createElement('style');styleSheet.innerHTML=styles;document.head.appendChild(styleSheet);block=document.createElement('div');block.id=hash;block.style.cssText='position:absolute;visibility:hidden;opacity:0;width:1px;height:1px';document.body.appendChild(block);for(i=0,l=events.length;i<l;i++)(function(i){block.addEventListener(events[i],function(a){if(!modal.animEndEvent){modal.animEndEvent=events[i];document.head.removeChild(styleSheet);document.body.removeChild(block)}})})(i)},__genStr:function(a){var i,text='',possible='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';for(i=0;i<a;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text},__triggerEvent:function(a,b,c){var d;if(window.CustomEvent){d=new CustomEvent(b,c)}else{d=document.createEvent('CustomEvent');d.initCustomEvent(b,true,true,c)}a.dispatchEvent(d)},__insertAfter:function(e,p){p.parentNode.insertBefore(e,p.nextSibling)},__addClass:function(e,c){var a=new RegExp('(^|\\s)'+c+'(\\s|$)','g');if(!a.test(e.className))e.className=(e.className+' '+c).replace(/\s+/g,' ').replace(/(^ | $)/g,'')},__removeClass:function(e,c){var a=new RegExp('(^|\\s)'+c+'(\\s|$)','g');e.className=e.className.replace(a,'$1').replace(/\s+/g,' ').replace(/(^ | $)/g,'')}};window.addEventListener('DOMContentLoaded',function(){modal.init()});
/**
 * ModalWindows v1.4.1 ( https://github.com/MattRh/modal_wins )
 * MalSerAl, 2015-2016
 */
 var modal={config:{isInited:false,modalBox:'.modal-box',modalsClass:'.modal',modalsCont:'.modal-wrapper',show:{stat:'opened',dyn:'show',swch:'switch',},hide:{stat:'closed',dyn:'hide'},loadCls:'loaded',hideByKey:27,urlPrefix:''},tStamps:[],init:function(){if(this.isInited)return false;this.isInited=true;this.modalBoxes=[];this.modalBoxes[1]=document.querySelector(this.config.modalBox);this.__addClass(this.modalBoxes[1],this.config.hide.stat);this.__addClass(this.modalBoxes[1],this.config.loadCls);this.boxTemplate=this.modalBoxes[1].cloneNode(true);this.modalRegExp=new RegExp('(\\s|^)'+this.config.modalsClass.substr(1)+'(\\s|$)');this.bodyStyle=document.body.style;this.openedModal=[];this.nestingLVL=0;this.__modalsCollect();this.__scrollSet();this.__anchorOpen()},show:function(a,s){var b,bodyStyle,el,lvl;el=document.getElementById(a);if(el===null||!el.className.match(this.modalRegExp)||!!~this.openedModal.indexOf(el))return false;if(s){this.__switchTo(el);return false}lvl=++this.nestingLVL;if(this.nestingLVL>1){this.modalBoxes[lvl]=this.boxTemplate.cloneNode(true);this.__insertAfter(this.modalBoxes[lvl],this.modalBoxes[lvl-1]);this.modalBoxes[lvl].querySelector(this.config.modalsCont).appendChild(el)}bodyStyle=this.bodyStyle;bodyStyle.overflowY='hidden';bodyStyle.paddingRight=this.scrollBar;this.__animate(this.modalBoxes[lvl],'show');this.__modalShow(el);if(this.config.hideByKey!==null)window.addEventListener('keyup',modal.__keyPress);if(typeof(this.onopen)=='function')this.onopen(el)},hide:function(){var a=this.nestingLVL;if(a==0)return false;var b=this.modalBoxes[a];this.__animate(this.modalBoxes[a],'hide',function(){modal.bodyStyle.overflowY=modal.bodyStyle.paddingRight=null;if(a>1)b.parentNode.removeChild(b)});this.__modalHide();this.nestingLVL--;if(this.config.hideByKey!==null&&modal.nestingLVL==0)window.removeEventListener('keyup',modal.__keyPress);if(typeof(this.onclose)=='function')this.onclose(b)},__modalShow:function(e,s){if(this.nestingLVL>1)this.modalBoxes[this.nestingLVL].querySelector(this.config.modalsCont).appendChild(e);this.openedModal[this.nestingLVL]=e;this.__animate(e,'show'+(s?'_switch':''))},__modalHide:function(a){var b=this.nestingLVL;var c=this.openedModal[b];this.__animate(c,'hide',function(){if(b>1)modal.modalBoxes[1].querySelector(modal.config.modalsCont).appendChild(c);if(typeof(a)=='function')a()});this.openedModal[b]=null},__switchTo:function(e){this.__modalHide(function(){modal.__modalShow(e,true)})},__animate:function(a,t,b){var c,act,swch,add,rem;if(window.onanimationend===null)c='animationend';else c='webkitAnimationEnd';t=t.split('_');act=t[0];swch=t[1]?true:false;if(act=='show'){add=this.config.show;rem=this.config.hide}else if(act=='hide'){add=this.config.hide;rem=this.config.show}else{return false}this.__addClass(a,swch?add.swch:add.dyn);this.__removeClass(a,rem.dyn);this.__removeClass(a,rem.stat);a.addEventListener(c,function modalshowev(){modal.__removeClass(a,swch?add.swch:add.dyn);modal.__addClass(a,add.stat);if(typeof(b)=='function')b();a.removeEventListener(c,modalshowev)})},__modalsCollect:function(){var a,modals,i,len;a=this.modalBoxes[1].querySelector(this.config.modalsCont);modals=document.querySelectorAll(this.config.modalsClass);for(i=0,len=modals.length;i<len;i++){if(modals[i].parentNode==a)continue;a.appendChild(modals[i]);this.__addClass(modals[i],this.config.hide.stat)}},__anchorOpen:function(){var a;if(this.config.urlPrefix!==null){a=window.location.hash.replace('#','');if(a!=''&&a.substr(0,this.config.urlPrefix.length)==this.config.urlPrefix){el=document.getElementById(a);if(el!=null&&el.className.match(this.modalRegExp))modal.show(a)}}},__scrollSet:function(){var a,heightData;a=document.createElement('div');a.style.cssText='visibility:hidden;width:100px;height:100px;overflow-y:scroll';document.body.appendChild(a);heightData=this.__getHeight();this.scrollBar=heightData[0]<heightData[1]?a.offsetWidth-a.clientWidth+'px':0;document.body.removeChild(a)},__keyPress:function(e){e.preventDefault();if(e.keyCode==modal.config.hideByKey)modal.hide()},__getHeight:function(){var a,windowHeight;if(window.innerHeight&&window.scrollMaxY)a=window.innerHeight+window.scrollMaxY;else if(document.body.scrollHeight>document.body.offsetHeight)a=document.body.scrollHeight;else if(document.documentElement&&document.documentElement.scrollHeight>document.documentElement.offsetHeight)a=document.documentElement.scrollHeight;else a=document.body.offsetHeight;if(self.innerHeight)windowHeight=self.innerHeight;else if(document.documentElement&&document.documentElement.clientHeight)windowHeight=document.documentElement.clientHeight;else if(document.body)windowHeight=document.body.clientHeight;return[windowHeight,a]},__insertAfter:function(e,p){p.parentNode.insertBefore(e,p.nextSibling)},__addClass:function(e,c){var a=new RegExp('(^|\\s)'+c+'(\\s|$)','g');if(!a.test(e.className))e.className=(e.className+' '+c).replace(/\s+/g,' ').replace(/(^ | $)/g,'')},__removeClass:function(e,c){var a=new RegExp('(^|\\s)'+c+'(\\s|$)','g');e.className=e.className.replace(a,'$1').replace(/\s+/g,' ').replace(/(^ | $)/g,'')}};window.addEventListener('DOMContentLoaded',function(){modal.init()});